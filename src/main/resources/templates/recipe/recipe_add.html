<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Add recipe</title>
    <script src="/js/adding_recipe_script.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="/css/styles.css">
</head>
<body>
<!-- Górne menu -->
<nav class="topbar">
    <div class="menu">
        <a href="http://localhost:8080/recipes/search?categoryName=preferences">SZYBKIE WYSZUKIWANIE</a>
        <a href="http://localhost:8080/recipes/search?categoryName=meal">DANIE</a>
        <a href="http://localhost:8080/recipes/search?categoryName=kitchen">REGION</a>
        <a href="http://localhost:8080/recipes">SZUKAJ PO SKŁADNIKACH</a>
    </div>
    <div class="icon-container">
        <img src="https://img.icons8.com/ios-filled/50/ffffff/kitchen.png" alt="Kitchen Icon"/>
    </div>
</nav>

<h1 th:if="${isEdit}">Edit recipe</h1>
<h1 th:unless="${isEdit}">Add recipe</h1>

<form th:action="${isEdit} ? @{/recipes/update} : @{/recipes/add}" th:object="${recipe}" method="post" onsubmit="beforeSubmit()">

    <input type="hidden" th:field="*{id}" />
    <input type="hidden" th:field="*{avgRating}" />

    <label for="recipeName">Recipe name:</label>
    <input type="text" id="recipeName" th:field="*{recipeName}">
    <span class="error-message"
           th:if="${#fields.hasErrors('recipeName')}"
           th:text="${#fields.errors('recipeName')}"></span>

    <label for="recipeDescription">Description:</label>
    <textarea id="recipeDescription" th:field="*{recipeDescription}" oninput="autoResize(this)"></textarea>
    <span class="error-message"
          th:if="${#fields.hasErrors('recipeDescription')}"
          th:text="${#fields.errors('recipeDescription')}"></span>

    <!--    ingredients-->

    <label for="ingredientSelect">Składniki:</label>
    <select id="ingredientSelect">
        <option value="" disabled selected>--Wybierz z listy--</option>
        <option th:each="ingredient : ${allIngredients}"
                th:value="${ingredient.id}"
                th:text="${ingredient.ingredientName}">
        </option>
    </select>

    <label for="ingredientQuantity">Ilość:</label>
    <input type="number" id="ingredientQuantity" min="1" value="1">

    <button type="button" onclick="addIngredient()">Dodaj składnik</button>

    <ul id="selectedIngredients">
        <li th:each="recipeIngredient : ${recipe.recipeIngredients}"
            th:id="'ingredient-' + ${recipeIngredient.ingredient.id}">
            <span id="ingredientName" th:text="${recipeIngredient.ingredient.ingredientName}"></span>
            <span id="quantity" th:text="' - ilość: ' + ${recipeIngredient.quantity}"></span>
            <button type="button" th:attr="onclick='removeIngredient(' + ${recipeIngredient.ingredient.id} + ')'">X</button>
        </li>
    </ul>

    <!-- Ukryte inputy do wysyłania składników -->
    <div id="ingredientsContainer">
        <input type="hidden" name="ingredientMap" id="ingredientMap" value="{}">
    </div>

    <!--    tag-->
    <label for="tagSelect">Tags:</label>
    <select id="tagSelect">
        <option value="" disabled selected>--Wybierz z listy--</option>
        <option th:each="tag : ${allTags}" th:value="${tag.id}" th:text="${tag.tagName}"></option>
    </select>
    <button type="button" onclick="addTag()">Dodaj tag</button>

    <ul id="selectedTags">
        <li th:each="tag : ${recipe.recipeTags}" th:id="'tag-' + ${tag.id}">
            <span th:text="${tag.tagName}"></span>
            <button type="button" th:attr="onclick='removeTag(' + ${tag.id} + ')'">X</button>
        </li>
    </ul>

    <!-- Hidden inputs for tag sending -->
    <div id="tagsContainer">
        <input type="hidden" th:each="tag : ${recipe.recipeTags}" th:name="recipeTags" th:value="${tag.id}">
    </div>

    <label for="amountOfPortions">Portions:</label>
    <input type="text" id="amountOfPortions" th:field="*{amountOfPortions}">
    <span class="error-message"
          th:if="${#fields.hasErrors('amountOfPortions')}"
          th:text="${#fields.errors('amountOfPortions')}"></span>

    <label for="preparationTime">Preparation time:</label>
    <input type="text" id="preparationTime" th:field="*{preparationTime}">
    <span class="error-message"
          th:if="${#fields.hasErrors('preparationTime')}"
          th:text="${#fields.errors('preparationTime')}"></span>

    <label for="difficulty">Difficulty:</label>
    <select id="difficulty" th:field="*{difficulty}">
        <option th:each="difficulty : ${T(com.example.recipes.enums.Difficulty).values()}" th:value="${difficulty}" th:text="${difficulty}"></option>
    </select>

    <button type="submit" th:if="${isEdit}">Dodaj</button>
    <button type="submit" th:unless="${isEdit}">Zapisz zmiany</button>
    <button onclick="window.location.href='/recipes'">
        Anuluj
    </button>
</form>

</body>
</html>